(function(c,b){function e(g){b.pushNotifications?b.pushNotifications.getUserToken(g):g(null)}function h(g,b,a){e(function(c){if(c)try{a||(a=[]),k(a)||a.push({name:"pushToken",value:c})}catch(e){}c=JSON.stringify({params:a,eventTypeKey:g,keyValue:b});d(c)})}function k(b){try{var a=!1;b.forEach(function(b){b.name&&"pushToken"===b.name&&(a=!0)});return a}catch(c){return!1}}function d(b){var a=new XMLHttpRequest;a.onerror=function(){};a.open("POST","https://esputnik.com/api/v1/event",!0);a.withCredentials=!0;
a.setRequestHeader("Authorization","Bearer eyJhbGciOiJSUzI1NiJ9.eyJzdWIiOiI0NTI0ZWZhYTJkYzI2MGRmYTM4YTE1NDBlMWE2YjM0NGQ0YjEwYjBjMjQ0M2MzOTIwMGFiNTk3ZWYyOTM0ZDFmMjBiNGZlMmIwMmEyYWM2MjZmNDU3YWY5YzcyMWM3MGQwOGU4Yzg1NzQxM2E3ZmJiYjYzMzVjODMyNTFlZWEwMmQ4OWViZDNlMzc3NTY2NTdhMzdkYTI2MmViZGMxNjAyMGQ4YWUxOTY5ZDE5NjM1OWZhMDBhOTlkOTVhMWNmIn0.vSqm9nnbgrV9r1bi0U86nfyjNoYIYGWz2oA6PKaXWJeOCazZMcFCcS41el9oTdpkV-N3OKj2-mY9yLUqRECdYQ");a.setRequestHeader("Content-Type","application/json");a.send(b)}var a=!1;c.__es_sdk?b=c.__es_sdk:(c.__es_sdk=b,b.isPushModuleOn=function(){return a});b.pushOn=function(g){b.pushNotifications&&!b.isPushModuleOn()?(a=!0,b.pushNotifications.init(g)):console.log("Push module unavailable")};b.sendEvent=function(a,b,c){h(a,b,c)};b.getPushToken=e;b.getPushContactId=function(a){b.pushNotifications?b.pushNotifications.getUserPushSubscriptionContactId(a):
a(null)};b.onWebPushSubscriptionChange=function(a){if(b.pushNotifications)b.pushNotifications.onSubscriptionChange(a,!0)}})(this,this.__es_sdk||{});
(function(C,w){function m(){try{R()?(x.c(function(){if("safari"===f.userAgent.name.toLowerCase()&&R()&&"default"===window.safari.pushNotification.permission(d.main.apnWebsitePushId).permission){var a={};a.domainId=d.main.APPLICATION_ID;a.userAgent=f.userAgent.name;a.userAgentVersion=f.userAgent.version;a.userAgentLanguage=window.navigator.F||window.navigator.language;a.OS=f.platform;a.subscriptionPage=window.location.href;window.safari.pushNotification.requestPermission(d.main.apnSubscriptionServiceUrl,
d.main.apnWebsitePushId,a,fa);x.close()}},S),x.show()):!f.b||f.b&&d.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS?ga():f.b&&!d.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS?ha.D():b.error("[registerController()] NO ACTIONS !!!")}catch(a){b.log("[registerController()] handle error ",a)}}function R(){return"safari"in window&&"pushNotification"in window.safari}function T(a){b.log("[init()] Started..");var c=d.urls,e=D;a&&a["service-worker"]&&a["service-worker"].relUrl?e=a:b.log("Custom service worker script url is not provided, use default");
c.SERVICE_WORKER_URL_HTTPS=e["service-worker"].relUrl;c=d.subscription;e=D;a&&a["service-worker"]&&a["service-worker"].scope?e=a:b.log("Custom service worker scope is not provided, use default");c.serviceWorkerScope=e["service-worker"].scope;b.log("Configuration: ");b.log("Target Domain: ",d.main.targetDomain);b.log("Proxy Domain: ",d.main.proxyDomain);b.log("Application ID: ",d.main.APPLICATION_ID);b.log("Notifications Service: ",d.main.notificationsService);b.log("Apple Push Notification Website Push ID: ",
d.main.apnWebsitePushId);b.log("Show Subscription IFrame Result [s]: ",d.subscription.timeSuccessShow);b.log("Timeout on ignore prompt: ",d.subscription.timeoutIgnorePopover);b.log("Timeout on block prompt: ",d.subscription.timeBlockPopover);b.log("Validation period: ",d.validation.validationPeriod);b.log("Is Validation Enabled: ",d.validation.isValidationEnabled);b.log("Validation Window Width: ",d.validation.validationWindowWidth);b.log("Validation Window Height: ",d.validation.validationWindowHeight);
b.log("Token Data Update Period: ",d.updates.tokenDataUpdatePeriod);b.log("Is show special for Https: ",d.main.IS_SHOW_SPECIAL_FOR_HTTPS);b.log("Use client proxy for special Https: ",d.main.USE_CLIENT_PROXY_FOR_SPECIAL_HTTPS);b.log("App Manifest URL: ",d.urls.APP_MANIFEST_URL_HTTPS);b.log("Service Worker URL: ",d.urls.SERVICE_WORKER_URL_HTTPS);b.log("Show IFrame for Https: ",d.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS);b.log("Show Prompt Delay: ",d.subscription.SHOW_PROMPT_DELAY);b.log("Is logger enabled: ",
d.logging.IS_LOGGER_ENABLED);f.platform=y.m();f.userAgent=y.u();f.b=y.b();f.isSupported=y.C();f.f=y.B();b.log("[init()] Environment: ",f);b.log("");f.b&&(a&&a.manifest?!0!==a.manifest.included:!D.manifest.included)&&"safari"!==f.userAgent.name.toLowerCase()&&(a=a&&a.manifest&&a.manifest.relUrl?a.manifest.relUrl:D.manifest.relUrl)&&(b.log("[injectManifest()] Started.."),c=document.createElement("link"),c.rel="manifest",c.href=a,document.head.appendChild(c),b.log("[injectManifest()] OK"));ia()}function fa(a){if("denied"===
a.permission)b.log("User refused push notifications");else if("granted"===a.permission){b.log("User allow push notifications");var c={};c.token=a.deviceToken;z.g(c)}}function ja(){b.log("[checkSubscriptionInGCM()] Started.. ");navigator.serviceWorker.ready.then(function(a){try{a.pushManager.getSubscription().then(function(c){b.log("[checkSubscriptionInGCM()] OK, subscription =",c);if(c){var e=K(c),g={};g.token=e;g.auth=E(c.getKey("auth"));g.p256dh=E(c.getKey("p256dh"));z.g(g)}else ka(a)})["catch"](function(a){b.error("[checkSubscriptionInGCM()] FAIL: ",
a)})}catch(c){}})}function ka(a){var c={userVisibleOnly:!0};F()&&(c.applicationServerKey=la(d.subscription.vapidApplicationServerKey));a.pushManager.subscribe(c).then(function(a){var c=K(a),b={};b.token=c;b.auth=E(a.getKey("auth"));b.p256dh=E(a.getKey("p256dh"));z.g(b)})["catch"](function(a){b.warn("[subscribe()] FAIL: ",a)})}function F(){var a=d.subscription.vapidApplicationServerKey;return a&&0!==a.length}function la(a){var c="=".repeat((4-a.length%4)%4);a=(a+c).replace(/\-/g,"+").replace(/_/g,
"/");a=window.atob(a);for(var c=new Uint8Array(a.length),b=0;b<a.length;++b)c[b]=a.charCodeAt(b);return c}function E(a){return btoa(String.fromCharCode.apply(null,new Uint8Array(a))).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}function K(a){b.log("[parseSubscriptionEndpoint()] Started... ");a=a.subscriptionId?a.subscriptionId:a.endpoint;b.log("[parseSubscriptionEndpoint()] OK, subscriptionEndpoint = ",a);return a}function ia(){h.get("Contacts",function(a){a.target.result&&a.target.result.value&&
G(a.target.result.value)})}function G(a){"localStorage"in window&&void 0!==a&&null!==a&&localStorage.setItem("esWebPushContactId",a)}function L(){for(var a=0;a<U.length;a++){var c;a:{var b=document.getElementById(U[a]);if(b)try{c=b.innerHTML.trim();break a}catch(g){}c=null}if(c&&/^\S+@\S+$/.test(c))return c}return null}function V(a,c){h.get("cmms",function(b){b.target.result?c(a,b.target.result.value):c(a,null)},function(){c(a,null)})}function W(a,c){var e=L();e&&z.h(a,"5",e,c,function(a,c){try{if(a&&
c&&(c=JSON.parse(c),c.cmms&&h.a({key:"cmms",value:c.cmms}),1==c.type)){var e=c.value;h.a({key:"Contacts",value:c.value},function(){G(e)})}}catch(d){b.error("[bind()] ",d)}})}function ma(a){a=a.scriptURL;a=0==a.indexOf(window.location.origin)?a.substring(window.location.origin.length):void 0;return a&&-1!=a.indexOf(d.urls.SERVICE_WORKER_URL_HTTPS)}function na(){h.remove("SID",function(){try{f.b&&!d.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS?X()["catch"](function(a){b.log("error unsubscribing",
a)}).then(function(){m()}):m()}catch(a){}},function(a){b.log("Failed to remove subscription info from storage: "+a.target.errorCode)})}function X(){return navigator.serviceWorker.ready.then(function(a){try{return a.pushManager.getSubscription().then(function(a){if(a)return a.unsubscribe()})["catch"](function(){})}catch(c){return Promise.reject(c)}})}function Y(a){var c=null;b.log("[init()] check utm labels:",window.location.search);window.location.search.replace(/^\?/,"").split("&").forEach(function(e){e=
e.split("=");a==e[0]&&(b.log("[init()] contactId from url =",e[1]),0===e[1]%1&&(c=e[1]))});var e;try{e=!isNaN(c-parseInt(c))}catch(g){e=!1}return e?c:null}function ga(){b.log("[showCustomPopOverDialogController()] Starting...");v.A(h,S);try{oa(function(a,c){a&&pa(function(a){try{a||qa(function(a){try{if(a){var e=new Date(c),k=new Date;H(e,k)>864E5*d.subscription.timeBlockPopover&&v.i()}else{var k=new Date;(!c||H(c,k)>1E3*d.subscription.timeoutIgnorePopover)&&v.i()}}catch(p){b.error("check before iframe",
p)}})}catch(g){b.error("check before iframe",g)}})})}catch(a){b.error("check before iframe",a)}}function oa(a){h.get("userPrompted",function(c){var e=null;void 0===c.target.result?b.log("New visitor, try to subscribe ..."):void 0!==c.target.result.value&&(e=new Date(c.target.result.value.date));a(!0,e)},function(){a(!1,null)})}function qa(a){h.get("refused",function(c){a(c.target.result)},function(c){b.log("Failed to retrieve refused key, error: "+c.target.errorCode);a(null)})}function pa(a){h.get("SID",
function(c){a(c.target.result)},function(c){b.log("Failed to retrieve ID key, error: "+c.target.errorCode);a(null)})}function S(){try{b.log("Subscription denied"),h.a({key:"refused",value:(new Date).toString()})}catch(a){}}function H(a,c){return c.getTime()-a.getTime()}function Z(){var a=window.location.protocol;return d.main.IS_SHOW_SPECIAL_FOR_HTTPS&&"https:"===a?!0:!1}function aa(a,c,b){var g=new Date;g.setTime(g.getTime()+864E5*b);document.cookie=a+"="+c+"; path=/;"+("expires="+g.toUTCString())}
function M(a){function c(c,g,d){b.log("[sendResultCallback()] save to indexedDb..");b.log("[sendResultCallback()]",c,g,d);try{if(c&&d){b.log("[sendResultCallback()] Starting save token to indexedDb:",d.token);var k={sid:d.token,bnd:g};F()&&a.auth&&(k.auth=a.auth);F()&&a.p256dh&&(k.p256dh=a.p256dh);h.a({key:"SID",value:k});h.a({key:"activeness.check",value:(new Date).getTime()});d.cmms&&h.a({key:"cmms",value:d.cmms});d.bindings?(b.log("[sendResultCallback()] Starting save to indexedDb:",d.bindings),
d.bindings.forEach(function(a){if(1==a.type){var c=a.value;h.a({key:"Contacts",value:a.value},function(){G(c)});try{d.status&&"NEW"===d.status&&I.rememberEvent({type:"subscription-change",data:{type:"new-subscription",token:d.token,contactId:a.value}})}catch(e){b.error("[evt error()]",e)}}else 2==a.type?aa("es-bind-id",a.value,1095):3==a.type&&h.a({key:"sw-md5",value:{hash:a.value,date:(new Date).toString()}})})):b.warn("[sendResultCallback()] return, data.bindings = ",d.bindings)}else b.warn("[sendResultCallback()] return, subscription not saved")}catch(p){b.error("[syncSubscription()]",
p)}}b.log("[syncSubscription()]",a);h.get("SID",function(e){try{if(!e.target.result)ba(a,c);else if(e.target.result.value!==a.token){var g=e.target.result.value;b.warn("[[syncSubscription()]] old data in indexedDB",g,a);ca(g,a,c)}}catch(d){b.error("[syncSubscription()]",d)}},function(){b.error("Failed to get SID data")})}function ba(a,c){b.log("[sendSubscriptionToService()]",a);try{var e=new XMLHttpRequest;e.onreadystatechange=function(){try{4==e.readyState&&(200==e.status?c(!0,!0,JSON.parse(e.responseText)):
409==e.status?c(!0,!0,JSON.parse(e.responseText)):(b.warn("Bad Response status = ",e),c(!1,!1,null)))}catch(a){b.error("[sendSubscriptionToService()]",a)}};e.open("PUT",d.main.notificationsService+"/v1/subscribe/",!0);e.setRequestHeader("Content-Type","application/json");var g={};g.domainId=d.main.APPLICATION_ID;g.endpoint=a.token;F()&&(a.auth&&a.p256dh&&(g.keys={},g.keys.auth=a.auth,g.keys.p256dh=a.p256dh),g.subscriptionType="VAPID");g.userAgent=f.userAgent.name;g.userAgentVersion=f.userAgent.version;
g.userAgentLanguage=window.navigator.F||window.navigator.language;g.OS=f.platform;g.subscriptionPage=window.location.href;g.binding=ra();e.send(JSON.stringify(g))}catch(n){b.error("[sendSubscriptionToService()]",n)}}function sa(a,c){try{var e=new XMLHttpRequest;e.onreadystatechange=function(){try{var a=!0;4==e.readyState&&(410==e.status&&(a=!1),h.a({key:"activeness.check",value:(new Date).getTime()},function(){c(a)}))}catch(d){b.error("[checkSubscriptionIsActive()]",d)}};e.open("GET",d.main.notificationsService+
"/v1/wps/"+d.main.APPLICATION_ID+"/subscription/state?sid="+encodeURIComponent(a),!0);e.setRequestHeader("Content-Type","application/json");e.send()}catch(g){c(!0)}}function ra(){var a={},c;if(l&&0!==l.length)c=l;else a:{if("localStorage"in window&&(c=localStorage.getItem("esWebPushContactId",c),void 0!==c&&null!==c))break a;c=null}c&&""!=c?(a.type="1",a.value=c):L()?(a.type="5",a.value=L()):""!=J&&(a.type="2",a.value=J);return a}function ca(a,c,e){b.log("Send updated subscription to server:"+c);
b.log("Old subscription:"+a);e(!0,null)}function da(a,c){h.get(a,function(a){try{var b=a.target.result;a=null;b&&(a=new Date(b.value));c(a)}catch(d){c(null)}})}function ta(a){da("validation",function(c){if(null!=c&&H(c,new Date)<d.validation.validationPeriod)return a(!1);a(!0)})}function ua(a){da("activeness.check",function(c){if(null!=c){try{var b=parseInt(c);Number.isNaN(b)||(c=b)}catch(d){}if(259200000>H(c,new Date)){a(!1);return}}a(!0)})}function va(a,c,e){try{ta(function(g){if(g){var n=
new XMLHttpRequest;n.onreadystatechange=function(){try{4==n.readyState&&200==n.status&&(N="true"===n.responseText?!0:!1,b.log("Is token valid: "+N),N?e():wa(a,c),h.a({key:"validation",value:(new Date).toString()}))}catch(d){b.log("Failed to update service worker: "+d)}};null!=a&&(n.open("GET",d.main.notificationsService+"/v1/subscription/validate?value="+a+"&app="+d.main.APPLICATION_ID,!0),n.setRequestHeader("Content-Type","application/json"),n.send())}else e()})}catch(g){b.log("Error: "+g)}}function wa(a,
c){var e=new XMLHttpRequest;e.onreadystatechange=function(){try{4==e.readyState&&200==e.status&&(b.log("Token is set to inactive"),h.remove("SID",function(){b.log("SID key is removed from storage");c()},function(a){b.log("Failed to remove subscription info from storage: "+a.target.errorCode)}))}catch(a){b.log("Failed to deactivate token: "+a)}};e.open("PUT",d.main.notificationsService+"/v1/subscription/"+a+"/inactive",!0);e.setRequestHeader("Content-Type","application/json");e.send()}C.__es_sdk||
(C.__es_sdk={});C.__es_sdk.pushNotifications=w;var D={manifest:{included:!1,relUrl:"/manifest.json"},"service-worker":{relUrl:"/sw.js",scope:"/"}},d={main:{targetDomain:"https://parfums.ua",proxyDomain:"https://parfums-push.esputnik.com",APPLICATION_ID:"A5EF3026-60EA-4B94-A359-5BD04C1E7B63",notificationsService:"https://push.esputnik.com",apnWebsitePushId:"",apnSubscriptionServiceUrl:"https://push.esputnik.com/v1/subscribe/apns/safari",isApnEnabled:false,IS_SHOW_SPECIAL_FOR_HTTPS:false,USE_CLIENT_PROXY_FOR_SPECIAL_HTTPS:false,
IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS:!1},subscription:{timeSuccessShow:3,timeoutIgnorePopover:60,timeBlockPopover:30,SHOW_PROMPT_DELAY:5,promptMode:1,subscriptionPromptAcceptBtnText:"Разрешить",subscriptionPromptDeclineBtnText:"Запретить",subscriptionPromptText:"Кликните &quot;Разрешить&quot;, чтобы первыми узнавать про акции и распродажи на PARFUMS",subscriptionPopoverType:2,
vapidApplicationServerKey:"",serviceWorkerScope:"/"},validation:{validationPeriod:86400000,isValidationEnabled:false,validationWindowWidth:500,validationWindowHeight:300},updates:{tokenDataUpdatePeriod:604800000},urls:{SERVICE_WORKER_URL_HTTPS:"/sw.js"},logging:{IS_LOGGER_ENABLED:"false"}},U=["EsputnikEmail","esputnikemail","esputnikEmail","eSputnikEmail","Esputnikemail"],
l="",J="",N=!1,I={};(function(a){var c={},e={};a.rememberEvent=function(a){try{if(e[a.type]||(e[a.type]=[]),e[a.type].push(a),c[a.type])for(var d=0;d<c[a.type].length;d++)if(c[a.type][d])try{c[a.type][d](a)}catch(k){b.log("failed to fire evt",k)}}catch(k){b.log("Failed to remember event",k)}};a.registerListener=function(a,b,d){c[a]||(c[a]=[]);if(d&&(d=e[a]))for(var p=0;p<d.length;p++)b(d[p]);c[a].push(b)}})(I);var xa={onPageLoad:1,byElementClick:2},O={"default":1,topPanel:2,bottomPanel:3},f={platform:null,
userAgent:null,isSupported:!1,b:!1,f:!1},ha={L:m,D:function(){b.log("[registerServiceWorker()] Started...");"serviceWorker"in navigator&&navigator.serviceWorker.register(d.urls.SERVICE_WORKER_URL_HTTPS,{scope:d.subscription.serviceWorkerScope}).then(function(a){b.log("[registerServiceWorker()] sw registered for scope: ",a.scope);b.log("[registerServiceWorker()] OK:",a);b.log("");ja()})["catch"](function(a){b.error("[registerServiceWorker()] FAIL:",a)})}},za={bind:function(){b.log("[bind()] Starting...");
l=Y("utm_content");J=ya.l("es-bind-id");b.log("[bind()] userId =",l);b.log("[bind()] uuid =",J);h.get("SID",function(a){function c(a){a&&""!==a&&sa(a,function(a){a?k():na()})}function e(){var b=a.target.result.value.sid;"serviceWorker"in navigator&&Z()?navigator.serviceWorker.getRegistration().then(function(a){a&&a.active&&ma(a.active)&&a.pushManager.getSubscription().then(function(a){a&&(a=K(a))&&-1!=a.indexOf(b)&&c(b)})["catch"](function(){})})["catch"](function(){}):c(b)}function g(c){var e=a.target.result.value.sid;
z.h(e,"1",l,null,function(a,d){try{if(a&&d){d=JSON.parse(d);var g=d.value;1==d.type&&h.a({key:"Contacts",value:d.value},function(){G(g);try{I.rememberEvent({type:"subscription-change",data:{type:"contact-id-update",token:e,contactId:c,newContactId:d.value}})}catch(a){b.error("[evt error()] ",a)}})}}catch(k){b.error("[bind()] ",k)}})}function n(){if(a.target.result.value){var c=a.target.result.value.sid;h.get("Contacts",function(a){try{if(a.target.result){var e=a.target.result.value;l&&""!==l&&l!=
e?g(e):V(c,W)}else l&&""!==l?g(null):V(c,W)}catch(d){b.log("[bind()] ",d)}})}}function k(){var c=a.target.result.value.sid;d.validation.isValidationEnabled&&!f.b?va(c,m,n):n()}b.log("[bind()] Starting...");b.log("[bind()]  Check SID in DB: ",a.target.result);try{window.localStorage.setItem("es_webpush_inited","1")}catch(p){}a.target.result?ua(function(a){a?e():k()}):(b.log("[bind()] No SID in DB, try to register"),f.b&&!d.main.IS_SHOW_CUSTOM_POP_OVER_DIALOG_FOR_SPECIAL_HTTPS?navigator.serviceWorker.getRegistrations().then(function(a){a&&
0<a.length?X().then(function(){m()}):m()})["catch"](function(){}):m())},function(){b.log("Failed to get data")});b.log("[bind()] Finish");b.log("")}},ya={l:function(a){var c="";a+="=";for(var b=document.cookie.split(";"),d=0;d<b.length;d++){for(var f=b[d];" "==f.charAt(0);)f=f.substring(1);0==f.indexOf(a)&&(c=f.substring(a.length,f.length))}return c},P:aa,I:function(){document.cookie=name+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}},z={N:ba,h:function(a,c,e,g,f){b.log("[sendBindRequestToService()] Starting...");
try{var k=new XMLHttpRequest;k.onreadystatechange=function(){try{4===k.readyState&&(200==k.status?f(!0,k.responseText):f(!1,null))}catch(a){b.error("[sendBindRequestToService()]",a)}};k.open("PUT",d.main.notificationsService+"/v1/bind/",!0);k.setRequestHeader("Content-Type","application/json");k.send(JSON.stringify({token:a,type:c,value:e,appId:d.main.APPLICATION_ID,cmms:g}))}catch(p){b.error("[sendBindRequestToService()]",p)}},O:ca,g:M,M:function(){b.log("Try Register User Visit");h.get("SID",function(a){b.log("Check SID in DB: ",
a.target.result);a.target.result?(b.log("Register User Visit"),a=a.target.result.value.sid,C.__es_sdk.J("user_visited_site",a,[{name:"sid",value:a}])):b.log("No SID in DB")})}},b={log:function(){console&&b.isEnabled()&&console.log.apply(console,arguments)},warn:function(){console&&b.isEnabled()&&console.warn.apply(console,arguments)},error:function(){console&&b.isEnabled()&&console.error.apply(console,arguments)},isEnabled:function(){return/true/.test(d.logging.IS_LOGGER_ENABLED)}},y={K:T,u:function(){var a,
c=navigator.userAgent,b=c.match(/(opera|chrome|safari|firefox|msie|yabrowser|trident(?=\/))\/?\s*(\d+)/i)||[],d=c.match(/(edge?(?=\/))\/?\s*(\d+)/i)||[];if("Edge"===d[1]||-1!=c.indexOf("Edg"))return{name:d[1],version:d[2]};if(/trident/i.test(b[1]))return a=/\brv[ :]+(\d+)/g.exec(c)||[],{name:"IE",version:a[1]||""};if("Chrome"===b[1]){a=c.match(/\bOPR\/(\d+)/);if(null!=a)return{name:"Opera",version:a[1]};if(a=c.match(/\bYaBrowser\/(\d+)/),null!=a)return{name:"Yandex",version:a[1]}}return b=b[2]?[b[1],
b[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=c.match(/version\/(\d+)/i))&&b.splice(1,1,a[1]),{name:b[0],version:b[1]}},m:function(){var a="Windows FreeBSD Android iPhone Linux Mac".split(" ");for(i=0;i<a.length;i++)if(-1!=navigator.userAgent.indexOf(a[i]))return a[i];return""},b:Z,C:function(){if("iPhone"===f.platform||""===f.platform)return!1;if("chrome"===f.userAgent.name.toLowerCase()&&42<=parseFloat(f.userAgent.version)||"firefox"===f.userAgent.name.toLowerCase()&&44<=parseFloat(f.userAgent.version))return!0;
if("safari"===f.userAgent.name.toLowerCase())return d.main.isApnEnabled&&10<=f.userAgent.version;if("opera"===f.userAgent.name.toLowerCase()&&43<=parseFloat(f.userAgent.version)||"yandex"===f.userAgent.name.toLowerCase()&&18<=parseFloat(f.userAgent.version))return!0},B:function(){var a=window.location.href;-1===d.main.targetDomain.indexOf("://www.")&&(a=a.replace("://www.","://"));return 0===a.indexOf(d.main.targetDomain)}},ea={c:T,j:function(){b.log("[checkData()] Started..");f.isSupported||b.warn("[checkData()] FAIL, Environment is not supported:",
f);f.f||b.warn("[checkData()] FAIL,this  is not target domain",f);b.log("[checkData()] Ok");b.log("")},G:Y};w.init=function(a){try{var c=function(){try{ea.c(a),ea.j(),f.isSupported&&f.f&&za.bind()}catch(c){b.log("[main()] handle error ",c)}};d.subscription.promptMode===xa.onPageLoad?setTimeout(c,1E3*d.subscription.SHOW_PROMPT_DELAY):document.addEventListener("click",function(a){a.target.closest(".es-push-prompt-init")&&(b.log("init subscription by click"),c())},!1)}catch(e){b.log("[init] handle error ",
e)}};w.getUserToken=function(a){h.get("SID",function(c){var b=null;c.target.result&&(b=c.target.result.value.sid);a(b)})};w.getUserPushSubscriptionContactId=function(a){h.get("Contacts",function(b){var d=null;b.target.result&&(d=b.target.result.value);try{d=parseInt(d),isNaN(d)&&(d=null)}catch(g){d=null}a(d)})};w.onSubscriptionChange=function(a,b){I.registerListener("subscription-change",a,b)};var h=function(){function a(a,c){try{var f=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||
window.msIndexedDB).open("es-push-integration",1);f.onsuccess=function(b){try{d=b.target.result,a()}catch(c){}};f.onerror=function(a){try{b.log("DB opening error: "+a.target.errorCode),c()}catch(d){}};f.onupgradeneeded=function(a){try{a.target.result.createObjectStore("integration-data",{keyPath:"key"})}catch(b){}}}catch(p){}}function c(c){try{d?c():a(function(){c()},function(){b.log("DB init failed")})}catch(f){b.log("Error occurred: "+f)}}var d=null;return{a:function(a,b,f){c(function(){var c=d.transaction(["integration-data"],
"readwrite").objectStore("integration-data").put(a);c.onsuccess=b;c.onerror=f})},remove:function(a,b,f){c(function(){var c=d.transaction(["integration-data"],"readwrite").objectStore("integration-data")["delete"](a);c.onsuccess=b;c.onerror=f})},get:function(a,b,f){c(function(){var c=d.transaction(["integration-data"],"readonly").objectStore("integration-data").get(a);c.onsuccess=b;c.onerror=f})}}}(),x=function(){function a(a,e){try{var f="push-notification-popover",h="push-notification-prompt-buttons";
d.subscription.subscriptionPopoverType===O.topPanel?(f="push-notification-popover-top",h="push-notification-prompt-inline-buttons"):d.subscription.subscriptionPopoverType===O.bottomPanel&&(f="push-notification-popover-bottom",h="push-notification-prompt-inline-buttons");var l=document.createElement("div");l.setAttribute("class","push-notification-prompt "+f);var r=document.createElement("div");r.setAttribute("class","push-notification-prompt-message");var q=document.createElement("div"),u=document.createElement("img");
u.setAttribute("class","push-notification-bell-icon");u.setAttribute("width","14");u.setAttribute("height","14");u.setAttribute("src",d.main.notificationsService+"/img/subscription-notify-icon.svg");q.appendChild(u);q.setAttribute("class","push-notification-prompt-message-text");var t=document.createElement("div");t.setAttribute("class",h);var A=document.createElement("button");A.setAttribute("class","push-notification-prompt-btn push-notification-accept-btn");A.setAttribute("type","button");A.onclick=
a;A.innerHTML=d.subscription.subscriptionPromptAcceptBtnText;var B=document.createElement("button");B.setAttribute("class","push-notification-prompt-btn push-notification-disallow-btn");B.setAttribute("type","button");B.onclick=function(){c();e()};B.innerHTML=d.subscription.subscriptionPromptDeclineBtnText;t.appendChild(B);t.appendChild(A);r.appendChild(q);if(d.subscription.subscriptionPopoverType===O["default"]){r.appendChild(t);var P=document.createElement("div");P.setAttribute("class","push-prompt-text");
P.innerHTML=d.subscription.subscriptionPromptText;q.appendChild(P)}else q.innerHTML+=d.subscription.subscriptionPromptText,q.appendChild(t);l.appendChild(r);var Q=document.createElement("span");Q.setAttribute("class","close-prompt");Q.onclick=function(){c()};r.appendChild(Q);l.style.visibility="hidden";return l}catch(Aa){return b.error("prompt ctor error: ",Aa),null}}function c(){try{null!=e&&(e.style.visibility="hidden")}catch(a){b.error("prompt widget error:",a)}}var e=null;return{c:function(b,
c){var f=document.getElementsByTagName("head")[0],h=document.createElement("link");h.rel="stylesheet";h.type="text/css";h.href=d.main.notificationsService+"/resource/"+d.main.APPLICATION_ID+"/es-subscription-prompt-style.css";f.appendChild(h);e=a(b,c);null!=e&&document.body.appendChild(e)},show:function(){try{null!=e&&(e.style.visibility="visible")}catch(a){b.error("prompt widget error:",a)}},close:c}}(),v=function(){function a(){window.addEventListener("message",function(a){try{if(0==a.origin.indexOf(d.main.proxyDomain))if("pong"==
a.data)clearInterval(q),c();else if("SYNC"==a.data)t.a({key:"synced",value:(new Date).toString()});else{var e=1E3*d.subscription.timeSuccessShow;if("refused"==a.data)r();else if(0===a.data.indexOf("SID|")){var f=a.data.split("|");if(2==f.length){var g={};g.token=f[1];M(g)}}else if(0===a.data.indexOf("SDO|"))try{f=a.data.split("|"),2==f.length&&(g=JSON.parse(f[1]),M(g))}catch(h){}setTimeout(function(){try{null!=m&&m.close()}catch(a){b.error("iframe: ",a)}},e)}}catch(h){b.error("iframe: ",h)}},!1)}
function c(){try{x.close()}catch(a){b.error("iframe: ",a)}}function e(){try{m=window.open(d.main.proxyDomain+"/subscription/"+d.main.APPLICATION_ID,"_blank","scrollbars=yes, width=500, height=500, top="+(h()/2-250+l())+", left="+(f()/2-250+k())),window.focus&&m.focus(),q=setInterval(function(){try{m.postMessage("ping",d.main.proxyDomain),m.postMessage("callFrom|"+window.location.href,d.main.proxyDomain)}catch(a){c()}},100)}catch(a){b.error("iframe: ",a)}}function f(){return window.innerWidth?window.innerWidth:
document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width}function h(){return window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height}function k(){return void 0!==window.screenLeft?window.screenLeft:screen.left}function l(){return void 0!==window.screenTop?window.screenTop:screen.top}var m=null,r=null,q=null,u=null,t=null;return{A:function(c,d){try{b.log("UI Module Init."),a(),r=d,x.c(e,r),t=c}catch(f){b.error("iframe: ",
f)}},i:function(){try{t.a({key:"userPrompted",value:{date:(new Date).toString()}}),x.show()}catch(a){b.error("iframe: ",a)}},R:function(){try{var a=v.w(),c=v.v(),e=a/2-d.validation.validationWindowWidth/2+v.o(),f=c/2-d.validation.validationWindowHeight/2+v.s();u=window.open(d.main.proxyDomain+"/resource/update-frame/"+d.main.APPLICATION_ID,"_blank","location=no, scrollbars=no, width="+d.validation.validationWindowWidth+", height="+d.validation.validationWindowHeight+", top="+f+", left="+e);u.blur();
window.focus()}catch(g){b.log("Error: "+g)}},H:c,w:f,v:h,o:k,s:l}}();return w})(this,{});
(function(c,b){function e(){for(var a=c[d].q;0<a.length;)h(a)}function h(a){try{if(0!=a.length){var b=a.shift(),c=b[0];a=[];for(var d=1;d<b.length;d++)a.push(b[d]);k(c,a)}}catch(e){}}function k(a,c){for(f in b)if(b.hasOwnProperty(f)){var d=b[f];if(f===a){d.apply(this,c);break}}}var d=c.esSdk;c[d]?(c[d].q||(c[d].q=[]),c[d].q.push=function(){var a=Array.prototype.push.apply(this,arguments);h(c[d].q);return a},e()):console.log("Using SDK synchronously")}(this,this.__es_sdk));
